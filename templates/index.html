{% extends "base.html" %} {% block content %}
<h1 class="text-center">Tableau des Missions</h1>

<!-- Timer -->
<div class="text-center mb-4">
  <h3>Temps restant jusqu'Ã  vendredi 31 :</h3>
  <div id="countdown" class="fs-4 text-danger"></div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="table-responsive">
      <table class="table table-bordered puzzle-table">
        <thead>
          <tr>
            <th></th>
            {% for col in "A B C D E".split() %}
            <th class="text-center">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for i in range(1, 41) %} {% if loop.index0 % 5 == 0 %}
          <tr>
            <td class="text-center">
              <strong>{{ loop.index // 5 + 1 }}</strong>
            </td>
            {% endif %}
            <td
              data-mission-id="{{ i }}"
              data-mission-name="{{ missions[i]['name'] }}"
              data-mission-description="{{ missions[i]['description'] }}"
              data-mission-status="{{ missions[i]['status'] }}"
              {% if missions[i]['status'] != 'locked' %}
              data-bs-toggle="modal"
              data-bs-target="#missionModal"
              {% endif %}
              class="puzzle-piece {{ missions[i]['status'] }}{% if i in completed_missions %} completed{% endif %}"
            >
              {% if missions[i]['status'] == 'locked' %} ðŸ”’ {% elif i in completed_missions %}
              âœ… <br />
              <small>{{ missions[i]['name'] }}</small> {% else %} ðŸ”“ <br />
              <small>{{ missions[i]['name'] }}</small>
              {% endif %}
            </td>
            {% if loop.index0 % 5 == 4 %}
          </tr>
          {% endif %} {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="missionModal"
  tabindex="-1"
  aria-labelledby="missionModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="missionModalLabel">
          DÃ©tails de la Mission
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <!-- Champ cachÃ© pour le mission_id -->
        <input type="hidden" id="hidden-mission-id" />
        <p><strong>ID de la Mission:</strong> <span id="mission-id"></span></p>
        <p>
          <strong>Description:</strong> <span id="mission-description"></span>
        </p>
        <p><strong>Tentatives:</strong> <span id="mission-attempts">0</span></p>
        <p>
          <strong>Validation:</strong> <span id="mission-validated">Non</span>
        </p>

        <!-- Champ pour la rÃ©ponse -->
        <div class="mt-3" id="mission-response-section">
          <label for="mission-response" class="form-label"><strong>Votre rÃ©ponse :</strong></label>
          <textarea
            id="mission-response"
            class="form-control"
            rows="3"
            placeholder="Entrez votre rÃ©ponse ici..."
          ></textarea>
        </div>
        <div
          class="alert alert-success mt-3"
          id="mission-validated-message"
          style="display: none"
        >
          Cette mission a dÃ©jÃ  Ã©tÃ© validÃ©e.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Fermer
        </button>
        <button type="button" class="btn btn-primary" id="submit-response">
          Soumettre
        </button>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}
